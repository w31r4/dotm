modules:
  # Foundational tools, managed by native package managers
  git:
    description: "Git version control system"
    check: "command -v git"
    install:
      debian: ["sudo apt-get update", "sudo apt-get install -y git"]
      macos: ["brew install git"]
      arch: ["sudo pacman -S --noconfirm git"]
  zsh:
    description: "Z shell, a powerful command-line interpreter"
    check: "command -v zsh"
    install:
      debian: ["sudo apt-get update", "sudo apt-get install -y zsh"]
      macos: ["brew install zsh"]
      arch: ["sudo pacman -S --noconfirm zsh"]
    apply:
      - { strategy: "inject", target: "~/.bashrc", line: 'source $HOME/.dotfiles/.zshrc' }
      - { strategy: "inject", target: "~/.profile", line: 'source $HOME/.dotfiles/.zshrc' }

  # x-cmd: Our new core package manager
  x-cmd:
    description: "x-cmd package manager for installing other tools"
    check: "command -v x"
    install:
      # The installation script is universal
      default: ['sh -c "$(curl -fsSL https://get.x-cmd.com)"']
    apply:
      - { strategy: "inject", target: "~/.zshrc", line: '[ ! -f "$HOME/.x-cmd.root/X" ] || . "$HOME/.x-cmd.root/X"' }

  # Tools to be installed via x-cmd
  fzf:
    description: "A command-line fuzzy finder"
    dependencies: [x-cmd]
    check: "command -v fzf"
    install:
      default: ["x env use fzf"]
  pyenv:
    description: "Python version management"
    dependencies: [git]
    check: "command -v pyenv"
    install:
      default: ["curl -fsSL https://pyenv.run | bash"]
    apply:
      - { strategy: "inject", target: "~/.zshrc", line: 'export PYENV_ROOT="$HOME/.pyenv"' }
      - { strategy: "inject", target: "~/.zshrc", line: '[[ -d $PYENV_ROOT/bin ]] && export PATH="$PYENV_ROOT/bin:$PATH"' }
      - { strategy: "inject", target: "~/.zshrc", line: 'eval "$(pyenv init - zsh)"' }

  # Eza: Installed via its custom script on Debian
  eza:
    description: "A modern replacement for ls"
    dependencies: [git] # Assuming git is needed for wget/curl, or other steps
    check: "command -v eza"
    install:
      debian:
        - "sudo apt-get update"
        - "sudo apt-get install -y gpg"
        - "sudo mkdir -p /etc/apt/keyrings"
        - "wget -qO- https://raw.githubusercontent.com/eza-community/eza/main/deb.asc | sudo gpg --dearmor -o /etc/apt/keyrings/gierens.gpg"
        - 'echo "deb [signed-by=/etc/apt/keyrings/gierens.gpg] http://deb.gierens.de stable main" | sudo tee /etc/apt/sources.list.d/gierens.list'
        - "sudo chmod 644 /etc/apt/keyrings/gierens.gpg /etc/apt/sources.list.d/gierens.list"
        - "sudo apt-get update"
        - "sudo apt-get install -y eza"
      macos: ["brew install eza"]
      arch: ["sudo pacman -S --noconfirm eza"]

  # Oh My Zsh and plugins
  oh-my-zsh:
    description: "Zsh configuration framework"
    dependencies: [zsh, git]
    check: "test -d $HOME/.oh-my-zsh"
    install:
      default: ['sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended']
  zsh-nvm:
    description: "Node Version Manager plugin for Zsh"
    dependencies: [oh-my-zsh]
    check: "test -d ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-nvm"
    install:
      default: ["git clone https://github.com/lukechilds/zsh-nvm ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-nvm"]
    apply:
      - { strategy: "inject", target: "~/.zshrc", line: "# To enable zsh-nvm, add 'zsh-nvm' to your plugins array in .zshrc" }

  # Go programming language
  go:
    description: "Go programming language environment"
    check: "command -v go"
    install:
      debian:
        - "wget https://go.dev/dl/go1.25.3.linux-amd64.tar.gz"
        - "sudo rm -rf /usr/local/go && sudo tar -C /usr/local -xzf go1.25.3.linux-amd64.tar.gz"
        - "rm go1.25.3.linux-amd64.tar.gz"
      macos: ["brew install go"]
    apply:
      - { strategy: "inject", target: "~/.zshrc", line: 'export PATH=$PATH:/usr/local/go/bin' }
      - { strategy: "inject", target: "~/.profile", line: 'export PATH=$PATH:/usr/local/go/bin' }

  # uv - Python package installer
  uv:
    description: "An extremely fast Python package installer and resolver"
    check: "command -v uv"
    install:
      default: ["curl -LsSf https://astral.sh/uv/install.sh | sh"]